<!doctype html>
<html class="no-js" ng-app="app">
    <head>
        <title>App</title>
        <meta charset="UTF-8">
        <meta http-equiv="x-ua-compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width">
        <link rel="icon" href="favicon.ico">
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="css/swagger-ui.min.css">
        <link rel="stylesheet" href="css/demo.css">

    </head>
    <body>
        <div  ng-controller="MyCtrl" class="container my-ctrl">
            <h1>Api</h1>
            <h3 ng-show="isLoading">Carregando ...</h3>

            <div ng-show="!isLoading" >
                <div>
                    <div >
                        <label>Token</label>
                        <input class="form-control"  type="text" ng-model="$root.token">
                    </div>
                </div>
            </div>
            <h3 ng-show="isLoading" swagger-translate="loading"></h3>
            <div swagger-ui url="swaggerUrl" loading="isLoading" api-explorer="true" trusted-sources="true" error-handler="myErrorHandler" permalinks="true"></div>
        </div>

        <!-- dependencies -->
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.0/angular.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.0/angular-sanitize.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/3.6.1/js-yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.6/marked.min.js"></script>
        <!-- angular-swagger-ui -->
        <script src="scripts/swagger-ui.min.js"></script>
        <script src="scripts/modules/swagger-external-references.min.js"></script>
        <script src="scripts/modules/swagger1-to-swagger2-converter.min.js"></script>
        <script src="scripts/modules/swagger-xml-formatter.min.js"></script>
        <script src="scripts/modules/swagger-yaml-parser.min.js"></script>
        <script src="scripts/modules/swagger-markdown.min.js"></script>
        <script src="scripts/modules/swagger-auth.min.js"></script>

        <script type="text/javascript">
                angular
                        .module('app', ['ngSanitize', 'swaggerUi'])
                        .config(function ($httpProvider) {
                            $httpProvider.interceptors.push(function ($q, $rootScope) {
                                return {
                                    'request': function (config) {
                                        if ($rootScope.token) {
                                            config.headers.Authorization = 'JWT ' + $rootScope.token;
                                        }
                                        return config || $q.when(config);
                                    },
                                    'response': function (response) {
                                        return response || $q.when(response);
                                    },
                                    'responseError': function (rejection) {
                                        return $q.reject(rejection);
                                    },
                                    'requestError': function (rejection) {
                                        return $q.reject(rejection);
                                    }
                                };
                            });
                        })

                        .controller('MyCtrl', function ($scope) {
                            // init form
                            $scope.isLoading = false;
                            $scope.url = $scope.swaggerUrl = 'api/swagger.json';
                            // error management
                            $scope.myErrorHandler = function (data, status) {
                                console.log('failed to load swagger: ' + status + '   ' + data);
                            };
                        });
        </script>

    </body>

</html>